<div class="d-flex" id="wrapper">
  <!-- Main content -->
  <div id="page-content-wrapper" class="w-100">
    <div class="overflow-hidden">
      <app-header></app-header>
      
      <div class="container-fluid mt-4 px-2">
        <app-spinner></app-spinner>
        <router-outlet></router-outlet>
        <div
          *ngIf="!fileUploaded"
          class="text-center mt-5 d-flex flex-column align-items-center gap-3"
        >
          <h1
            class="text-secondary fw-bolder animate__animated animate__bounceInDown animate"
          >
            Welcome to Contract Analyzer!
          </h1>
 
          <div>
            <h4
              class="text-primary animate__animated animate__fadeInUp animate__delay-1s"
            >
              Upload a Contract to Analyze the Compliances
            </h4>
            <p
              class="text-primary animate__animated animate__zoomIn animate__delay-2s"
            >
              Once uploaded, the contract will be analyzed for compliance risks
              across multiple regulatory areas.
            </p>
          </div>
 
          <!-- Card for Upload, Model, Country, and Analyze -->
          <div class="card shadow-sm p-4 w-100" style="max-width: 600px;">
            <div class="row g-3 align-items-center">
              <div class="col-12">
                <label for="contractUpload" class="btn btn-outline-primary w-100"
                  >Upload Contract</label
                >
                <input
                  type="file"
                  id="contractUpload"
                  (change)="onFileSelected($event)"
                  accept="application/pdf"
                  hidden
                />
                <div *ngIf="fileName" class="mt-2 text-secondary fw-bold small">
                  Selected File: {{ fileName }}
                </div>
              </div>
 
              <div class="col-12">
                <label for="modelSelect" class="form-label fw-bold text-secondary"
                  >Select Model</label
                >
                <select
                  id="modelSelect"
                  class="form-select"
                  [(ngModel)]="selectedModel"
                  (change)="onModelChange($event)"
                >
                  <option [value]="1">Mistral</option>
                  <option [value]="2">Gemini-2.5-pro</option>
                </select>
              </div>
 
              <div class="col-12">
                <label for="countrySelect" class="form-label fw-bold text-secondary"
                  >Select Country</label
                >
                <select
                  id="countrySelect"
                  class="form-select"
                  [(ngModel)]="selectedCountry"
                  (change)="onCountryChange($event)"
                >
                  <option [value]="1">USA</option>
                  <option [value]="2">UK</option>
                  <option [value]="3">India</option>
                  <option [value]="4">UAE</option>
                  <option [value]="5">Saudi Arabia</option>
                  <option [value]="6">Qatar</option>
                </select>
              </div>
 
              <div class="col-12">
                <button
                  class="btn btn-primary w-100"
                  [disabled]="!fileName"
                  (click)="analyzeContract()"
                >
                  Analyze
                </button>
              </div>
            </div>
          </div>
        </div>
 
        <div class="row px-4" *ngIf="fileUploaded">
          <div
            [ngClass]="{
              'col-md-12': analysisResult.length === 0,
              'col-md-6': analysisResult.length > 0
            }"
            class="overflow-hidden"
          >
            <div class="accordion" id="pdfAccordion">
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingPdf">
                  <button
                    class="accordion-button text-secondary fw-bold"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#collapsePdf"
                    aria-expanded="true"
                    aria-controls="collapsePdf"
                  >
                    Contract PDF Viewer
                  </button>
                </h2>
                <div
                  id="collapsePdf"
                  class="accordion-collapse collapse show"
                  aria-labelledby="headingPdf"
                  data-bs-parent="#pdfAccordion"
                >
                  <div
                    class="accordion-body overflow-hidden"
                    style="height: 80vh"
                  >
                    <ngx-extended-pdf-viewer
                      [src]="pdfSrc"
                      [textLayer]="true"
                      [showHandToolButton]="true"
                      [showDownloadButton]="false"
                      [showPrintButton]="false"
                      [showFindButton]="true"
                      height="100%"
                      (pdfLoaded)="loadComplete($event)"
                      (pageRendered)="pageRendered($event)"
                      (updateFindMatchesCount)="updateFindMatchesCount($event)"
                      (updateFindState)="updateFindState($event)"
                    ></ngx-extended-pdf-viewer>
                  </div>
                </div>
              </div>
            </div>
          </div>
 
          <!-- Compliance Analysis Results -->
          <div class="col-md-6" *ngIf="analysisResult.length > 0">
            <div class="accordion" id="analysisAccordion">
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingAnalysis">
                  <button
                    class="accordion-button collapsed text-secondary fw-bold"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#collapseAnalysis"
                    aria-expanded="false"
                    aria-controls="collapseAnalysis"
                  >
                    Compliance Analysis Results
                  </button>
                </h2>
                <div
                  id="collapseAnalysis"
                  class="accordion-collapse collapse show"
                  aria-labelledby="headingAnalysis"
                  data-bs-parent="#analysisAccordion"
                >
                  <div
                    class="accordion-body p-0"
                    style="height: 80vh; display: flex; flex-direction: column"
                  >
                    <!-- Scrollable Cards -->
                    <div class="flex-grow-1 overflow-auto p-3">
                      <div
                        *ngIf="analysisResult.length === 0"
                        class="text-muted"
                      >
                        No issues found or no file analyzed yet.
                      </div>
 
                      <div
                        *ngFor="let item of analysisResult"
                        class="card mb-3 shadow-sm"
                      >
                        <div class="card-body">
                          <h6 class="card-title text-primary">
                            {{ item.compliance_area }}
                          </h6>
                          <p class="mb-1">
                            <strong>Status:</strong> {{ item.missing_clause }}
                          </p>
 
                          <p *ngIf="item.extracted_text">
                            <strong>Extracted Clause:</strong><br />
                            <span class="text-muted">{{
                              item.extracted_text
                            }}</span>
                            <button
                              class="btn btn-sm btn-link text-primary ms-2"
                              (click)="highlightTextt(item.extracted_text)"
                            >
                              Jump in Pdf <i class="bi bi-arrow-up-right-square"></i>
                            </button>
                          </p>
 
                          <p
                            *ngIf="!item.extracted_text"
                            class="text-danger small"
                          >
                            Clause not found in the contract.
                          </p>
                        </div>
                      </div>
                    </div>
 
                    <!-- Fixed Feedback Section -->
                    <div
                      *ngIf="analysisResult.length > 0"
                      class="text-center rounded py-3 border-top bg-white"
                    >
                      <p class="fw-bold text-secondary mb-2">
                        Was this analysis helpful?
                      </p>
                      <button
                        class="btn btn-outline-success btn-sm me-2"
                        (click)="submitFeedback('like')"
                        [disabled]="feedbackSubmitted"
                      >
                        <i class="bi bi-hand-thumbs-up"></i> Like
                      </button>
                      <button
                        class="btn btn-outline-danger btn-sm"
                        (click)="submitFeedback('dislike')"
                        [disabled]="feedbackSubmitted"
                      >
                        <i class="bi bi-hand-thumbs-down"></i> Dislike
                      </button>
                      <div
                        *ngIf="feedbackSubmitted"
                        class="text-success mt-2 small"
                      >
                        Thank you for your feedback!
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
 
        <!-- Error Message -->
        <p *ngIf="errorMessage" class="text-danger mt-3">{{ errorMessage }}</p>
      </div>
    </div>
  </div>
</div>