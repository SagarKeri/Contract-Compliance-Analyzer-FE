<ng-container *ngIf="!isLoggedIn; else loggedInLayout">
  <router-outlet></router-outlet>
</ng-container>

<ng-template #loggedInLayout>
  <div class="d-flex" style="height: 100vh">
    <div
      id="sidebar"
      class="bg-white text-dark flex-shrink-0 p-3 border-end transition d-flex flex-column shadow-lg"
      [ngClass]="{ collapsed: isCollapsed }"
      [style.width]="isCollapsed ? '70px ' : '250px'"
      style="min-height: 100vh; transition: all 0.3s ease"
    >
      <div class="text-center mb-4" *ngIf="!isCollapsed">
        <img
          src="../../../assets/images/csgLogo.png"
          alt="CSG Logo"
          width="200px"
          height="55px"
          class="me-2 p-1"
          style="background-color: white; cursor: pointer"
          (click)="goToAnalyze()"
        />
      </div>

      <!-- Main Menu -->
      <ul class="list-unstyled flex-grow-1">
        <!-- Dashboard -->
        <li>
          <a
            routerLink="/my-analysis"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }"
            class="d-flex align-items-center py-2 px-2 text-dark text-decoration-none"
          >
            <i class="bi bi-house-fill fs-4 text-primary"></i>
            <span class="ms-2 fw-bold text-secondary" *ngIf="!isCollapsed">
              Dashboard
            </span>
          </a>
        </li>

        <!-- Analyzer -->
        <li>
          <a
            routerLink="/analyze"
            routerLinkActive="active"
            class="d-flex align-items-center py-2 px-2 text-dark text-decoration-none"
          >
            <i class="bi bi-clipboard-data-fill fs-4 text-primary"></i>
            <span class="ms-2 fw-bold text-secondary" *ngIf="!isCollapsed">
              Analyzer
            </span>
          </a>
        </li>

        <!-- Admin Dropdown -->
        <li *ngIf="isAdmin">
          <a
            class="d-flex align-items-center py-2 px-2 text-primary fw-bold text-decoration-none"
            data-bs-toggle="collapse"
            href="#adminMenu"
            role="button"
            [attr.aria-expanded]="isAdminActive"
            aria-controls="adminMenu"
          >
            <i class="bi bi-gear-fill fs-4 text-primary"></i>
            <span
              class="ms-2 flex-grow-1 fw-bold text-secondary"
              *ngIf="!isCollapsed"
            >
              Admin
            </span>
            <i class="bi bi-caret-down-fill float-end" *ngIf="!isCollapsed"></i>
          </a>

          <!-- Submenu -->
          <div
            class="collapse ms-3"
            id="adminMenu"
            [ngClass]="{ show: isAdminActive }"
            *ngIf="!isCollapsed"
          >
            <ul class="list-unstyled">
              <li>
                <a
                  routerLink="/country"
                  routerLinkActive="active"
                  class="d-block py-2 px-2 text-dark text-decoration-none fw-bold text-secondary"
                >
                  <i class="bi bi-flag-fill me-2 fs-4 text-primary"></i> Country
                </a>
              </li>
              <li>
                <a
                  routerLink="/domain"
                  routerLinkActive="active"
                  class="d-block py-2 px-2 text-dark text-decoration-none fw-bold text-secondary"
                >
                  <i class="bi bi-diagram-3-fill me-2 fs-4 text-primary"></i>
                  Domain
                </a>
              </li>
              <li>
                <a
                  routerLink="/clause"
                  routerLinkActive="active"
                  class="d-block py-2 px-2 text-dark text-decoration-none fw-bold text-secondary"
                >
                  <i
                    class="bi bi-file-earmark-text-fill me-2 fs-4 text-primary"
                  ></i>
                  Clause
                </a>
              </li>
              <li>
                <a
                  routerLink="/user"
                  routerLinkActive="active"
                  class="d-block py-2 px-2 text-dark text-decoration-none fw-bold text-secondary"
                >
                  <i class="bi bi-people-fill me-2 fs-4 text-primary"></i>
                  Role Management
                </a>
              </li>
            </ul>
          </div>
        </li>
      </ul>

      <!-- Logout at Bottom -->
      <div class="mt-auto">
        <a
          data-bs-toggle="modal"
          data-bs-target="#logoutModal"
          style="cursor: pointer"
          class="logout-link d-flex align-items-center py-2 px-2 text-danger fw-bold text-decoration-none"
        >
          <i class="bi bi-box-arrow-right"></i>
          <span class="ms-2" *ngIf="!isCollapsed">Logout</span>
        </a>
      </div>
    </div>
    <div
      class="sidebar-toggle-btn d-flex align-items-center justify-content-center"
      (click)="isCollapsed = !isCollapsed"
    >
      <i
        class="bi"
        [ngClass]="isCollapsed ? 'bi-chevron-right' : 'bi-chevron-left'"
      ></i>
    </div>
    <div class="flex-grow-1 d-flex flex-column">
      <div class="d-flex align-items-center border-bottom bg-light">
        <div class="flex-grow-1">
          <app-header></app-header>
        </div>
      </div>

      <div class="flex-grow-1 overflow-auto p-3">
        <router-outlet></router-outlet>
      </div>
    </div>
  </div>

  <div
    id="genieButton"
    class="genie-button animate position-fixed bottom-0 end-0 m-3 bg-white shadow-lg rounded-circle d-flex align-items-center justify-content-center"
    style="
      width: 60px;
      height: 60px;
      cursor: pointer;
      z-index: 1050;
      border: 1px solid #0f6368;
    "
    data-bs-toggle="collapse"
    data-bs-target="#genieWindow"
    aria-expanded="false"
    aria-controls="genieWindow"
  >
    <i class="bi bi-robot text-primary" style="font-size: 1.8rem"></i>
    <span class="ripple"></span>
  </div>

  <!-- Contract Genie Window -->
  <div
    id="genieWindow"
    class="collapse chatbot-window position-fixed bottom-0 end-0 m-3 shadow-lg p-0 rounded bg-white"
    style="
      width: 400px;
      height: 500px;
      z-index: 1060;
      border: 1px solid #0f6368;
    "
  >
    <div
      class="d-flex justify-content-between align-items-center p-2 border-bottom bg-secondary rounded-top"
    >
      <h6 class="mb-0 text-white fw-bold">
        <i class="bi bi-robot me-2"></i> Contract Genie
      </h6>
      <button
        class="btn-close btn-close-white"
        data-bs-toggle="collapse"
        data-bs-target="#genieWindow"
        aria-label="Close"
      ></button>
    </div>

    <div class="h-100 overflow-auto">
      <app-contract-genie></app-contract-genie>
    </div>
  </div>
</ng-template>

<!-- Logout Modal -->
<div
  class="modal fade"
  id="logoutModal"
  tabindex="-1"
  aria-labelledby="logoutModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="logoutModalLabel">
          <i class="bi bi-exclamation-triangle-fill me-2"></i> Confirm Logout
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body text-center">
        <i class="bi bi-question-circle-fill text-warning fs-2 mb-3"></i>
        <p class="fw-bold">Are you sure you want to logout?</p>
      </div>
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="bi bi-x-circle me-1"></i> Cancel
        </button>
        <button
          type="button"
          class="btn btn-danger"
          (click)="confirmLogout()"
          data-bs-dismiss="modal"
        >
          <i class="bi bi-box-arrow-right me-1"></i> Logout
        </button>
      </div>
    </div>
  </div>
</div>
