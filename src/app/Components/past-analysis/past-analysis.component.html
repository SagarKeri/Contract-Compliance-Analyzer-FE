<!-- Summary Section -->
<div class="card shadow-lg mb-5 border mx-5 shadow-lg">
  <div class="card-header bg-light">
    <h5 class="mb-0 text-secondary fw-bold">
      <i class="bi bi-graph-up-arrow me-2"></i>
      Summary
    </h5>
  </div>
  <div class="card-body">
    <div class="row g-4 px-2 text-center">
      <!-- Total Analyses -->
      <div class="col-md-4">
        <div
          class="summary-card position-relative p-4 shadow-sm rounded bg-info text-white h-100"
        >
          <!-- Icon top-left -->
          <i
            class="bi bi-bar-chart-fill fs-4 position-absolute top-0 start-0 m-3"
          ></i>

          <!-- Centered content -->
          <div
            class="d-flex flex-column align-items-center justify-content-center h-100"
          >
            <h2 class="fw-bolder mb-1">{{ totalCount }}</h2>
            <h6 class="fw-bold text-uppercase">Total Analyses</h6>
          </div>
        </div>
      </div>

      <!-- Successful Analyses -->
      <div class="col-md-4">
        <div
          class="summary-card position-relative p-4 shadow-sm rounded bg-success text-white h-100"
        >
          <i
            class="bi bi-check-circle-fill fs-4 position-absolute top-0 start-0 m-3"
          ></i>
          <div
            class="d-flex flex-column align-items-center justify-content-center h-100"
          >
            <h2 class="fw-bolder mb-1">{{ successCount }}</h2>
            <h6 class="fw-bold text-uppercase">Success</h6>
          </div>
        </div>
      </div>

      <!-- Failed Analyses -->
      <div class="col-md-4">
        <div
          class="summary-card position-relative p-4 shadow-sm rounded bg-danger text-white h-100"
        >
          <i
            class="bi bi-x-circle-fill fs-4 position-absolute top-0 start-0 m-3"
          ></i>
          <div
            class="d-flex flex-column align-items-center justify-content-center h-100"
          >
            <h2 class="fw-bolder mb-1">{{ failureCount }}</h2>
            <h6 class="fw-bold text-uppercase">Failure</h6>
          </div>
        </div>
      </div>

      <!-- Fast Analyses -->
      <!-- <div class="col-md-3">
      <div class="summary-card position-relative p-4 shadow-sm rounded bg-warning text-dark h-100">
        <i class="bi bi-lightning-fill fs-4 position-absolute top-0 start-0 m-3"></i>
        <div class="d-flex flex-column align-items-center justify-content-center h-100">
          <h2 class="fw-bolder mb-1">00</h2>
          <h6 class="fw-bold text-uppercase">Fast Analyses</h6>
        </div>
      </div>
    </div> -->
    </div>
  </div>
</div>

<div class="card shadow-lg mb-5 border-0 mx-5">
  <div
    class="card-header bg-secondary d-flex justify-content-between align-items-center"
  >
    <h5 class="mb-0 text-white fw-bold">
      <i class="bi bi-clock-history me-2"></i> Past Analyses
    </h5>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table
        class="table table-hover align-middle mb-0 table-bordered text-center custom-table"
      >
        <thead class="table-light">
          <tr>
            <th style="width: 70px">#</th>
            <th>Contrcat Pdf Name</th>
            <th>Start Time</th>
            <th>End Time</th>
            <th>Time Taken</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="
              let analysis of analyses
                | paginate : { itemsPerPage: itemsPerPage, currentPage: page };
              let i = index
            "
          >
            <td class="fw-medium">{{ i + 1 + (page - 1) * itemsPerPage }}</td>
            <td class="fw-semibold">{{ analysis.pdfName }}</td>
            <td>{{ analysis.start_time | date : "short" }}</td>
            <td>{{ analysis.end_time | date : "short" }}</td>
            <td>
              {{ analysis.time_diff }}
              <ng-container
                *ngIf="
                  isFastAnalysis(analysis.time_diff) && analysis.is_success
                "
              >
                <i
                  class="bi bi-lightning-fill text-warning ms-2"
                  title="Completed in under 1 minute"
                ></i>
              </ng-container>
            </td>
            <td>
              <ng-container *ngIf="analysis.is_success; else failed">
                <span class="badge bg-success px-3 py-2"
                  ><i class="bi bi-check-lg"></i> Success</span
                >
              </ng-container>
              <ng-template #failed>
                <span class="badge bg-danger px-3 py-2"
                  ><i class="bi bi-x-lg"></i> Failed</span
                >
              </ng-template>
            </td>
            <td>
              <button
                class="btn btn-sm btn-outline-primary me-2"
                (click)="viewAnalysis(analysis.cached_response_id)"
                [disabled]="!analysis.is_success"
              >
                <i class="bi bi-eye-fill me-1"></i> View
              </button>
              <button
                class="btn btn-sm btn-outline-success"
                (click)="downloadContractExcel(analysis.cached_response_id)"
                [disabled]="!analysis.is_success"
              >
                <i class="bi bi-file-earmark-spreadsheet-fill me-1"></i>
                Download
              </button>
            </td>
          </tr>

          <tr *ngIf="analyses.length === 0">
            <td colspan="7" class="text-center py-5 text-muted">
              <i class="bi bi-emoji-frown fs-4 me-2"></i> No past analyses
              found.
              <a
                routerLink="/analyze"
                class="ms-2 text-decoration-none fw-bold text-primary"
              >
                Try Contract Analyze
                <i class="bi bi-arrow-up-right-square ms-1"></i>
              </a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="mt-4 d-flex justify-content-center">
      <pagination-controls
        class="pagination"
        (pageChange)="page = $event"
      ></pagination-controls>
    </div>
  </div>
</div>
